<%= render 'shared/errors', obj: @market %>


<div class= "container">
    <div class="row">
        <div class= "well col-md-8">
            <h1><%= @market.name %> </br>
            <small><%= @market.description %></h1></small>
            <h5>Market Type: <%= @market.market_type.mechanism %></h5>
            <h5>Founder: <%= @market.founder_name %></h5>

            <h2>Outcomes</h2>
            <% @market.market_outcomes.each do |mo| %>
                <% mo_presenter = MarketOutcomePresenter.new(mo, self) %>
                <span class="h3 col-md-3 col-md-offset-5"><%= mo_presenter.outcome %></span><br>
                
                <% if current_user %>
                    <div class= "col-md-6">
                        <p class="text-center">Backs</p>
                        <%= mo_presenter.new_bet_button(:newback, current_user) %>
                        <% mo_presenter.create_bet_hash(mo_presenter.backs).each do |odds, amount| %>
                            <%= mo_presenter.bet_button(odds, amount, :back)%>    
                        <% end %>
                    </div>
    
                    <div class= "col-md-6">
                        <p class="text-center">Lays</p>
                        <%= mo_presenter.new_bet_button(:newlay, current_user) %>                              
                        <% mo_presenter.create_bet_hash(mo_presenter.lays).each do |odds, amount| %>
                            <%= mo_presenter.bet_button(odds, amount, :lay)%>
                        <% end %>
                    </div>
                <% end %>
                
                            </br></br></br>
            <% end %>
        </div>
        
        <% if current_user %>
            <div class= "col-md-4 standard_box">
                <h3 class="text-center">Your Bets</h3>
                <% if @market.user_lays(current_user) %>
                    <div class= col-md-6>
                        <h4>Open Backs</h4>              
                        <%= render partial: "user_bets", locals: { direction: :back } %>                
                    </div>
                    <div class= "col-md-6">
                        <h4>Open lays</h4>
                        <%= render partial: "user_bets", locals: { direction: :lay } %>
                    </div>
                <% end %>
            </div>
        <% end %>

        <div class= "col-md-4 standard_box box_height_medium">

            <h3 class="text-center">Users</h3>
                <ul id="market-users-list" class="no-bullets">
                    <div id="user_partial">
                        <%= render partial: "user", collection: @market.users %>
                    </div>
                </ul>
        </div>

    </div>

    <div class="row">
        <div class= "col-md-8">
            <% if current_user && current_user == @market.mkfounder %>
                <p class="text-center"><%= link_to "Edit Market", edit_market_path, class: "btn btn-warning" %></p>
            <% end %>
            <% if @market.user_markets.where(user: current_user).exists? %>
                <p class="text-center inline"><%= link_to "Leave Market", leave_market_path, remote: true, id: "joinleave-market", class: "btn btn-warning" %></p>
            <% else %>
                <p class="text-center inline"><%= link_to "Join Market", join_market_path, remote: true, id: "joinleave-market", class: "btn btn-primary" %></p>
            <% end %> 
        </div>
    </div>
</div>